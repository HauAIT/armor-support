"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _2 = require("..");
var _chai = _interopRequireDefault(require("chai"));
var _chaiAsPromised = _interopRequireDefault(require("chai-as-promised"));
var _bluebird = _interopRequireDefault(require("bluebird"));
var _http = _interopRequireDefault(require("http"));
var _mjpegServer = _interopRequireDefault(require("mjpeg-server"));
const {
  MJpegStream
} = _2.mjpeg;
const TEST_IMG_JPG = '/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/4QOBaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjYtYzE0MCA3OS4xNjA0NTEsIDIwMTcvMDUvMDYtMDE6MDg6MjEgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6NGY5ODc1OTctZGE2My00Y2M0LTkzNDMtNGYyNjgzMGUwNjk3IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjlDMzI3QkY0N0Q3NTExRThCMTlDOTVDMDc2RDE5MDY5IiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjlDMzI3QkYzN0Q3NTExRThCMTlDOTVDMDc2RDE5MDY5IiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NGY5ODc1OTctZGE2My00Y2M0LTkzNDMtNGYyNjgzMGUwNjk3IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjRmOTg3NTk3LWRhNjMtNGNjNC05MzQzLTRmMjY4MzBlMDY5NyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pv/uAA5BZG9iZQBkwAAAAAH/2wCEABALCwsMCxAMDBAXDw0PFxsUEBAUGx8XFxcXFx8eFxoaGhoXHh4jJSclIx4vLzMzLy9AQEBAQEBAQEBAQEBAQEABEQ8PERMRFRISFRQRFBEUGhQWFhQaJhoaHBoaJjAjHh4eHiMwKy4nJycuKzU1MDA1NUBAP0BAQEBAQEBAQEBAQP/AABEIACAAIAMBIgACEQEDEQH/xABgAAEAAwEAAAAAAAAAAAAAAAAABAUHCAEBAAAAAAAAAAAAAAAAAAAAABAAAQMCAgsAAAAAAAAAAAAAAAECBBEDEgYhMRODo7PTVAUWNhEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8Az8AAdAAAAAAI8+fE8dEuTZtzZR7VMb6OdTE5GJoYirrUp/e8qd9wb3TGe/lJ2551sx8D/9k=';
const should = _chai.default.should();
_chai.default.use(_chaiAsPromised.default);
const MJPEG_SERVER_PORT = 8589;
const MJPEG_SERVER_URL = `http://localhost:${MJPEG_SERVER_PORT}`;
function initMJpegServer(port, intMs = 300, times = 20) {
  const server = _http.default.createServer(async function (req, res) {
    const mJpegReqHandler = _mjpegServer.default.createReqHandler(req, res);
    const jpg = Buffer.from(TEST_IMG_JPG, 'base64');
    for (let i = 0; i < times; i++) {
      await _bluebird.default.delay(intMs);
      mJpegReqHandler._write(jpg, null, _lodash.default.noop);
    }
    mJpegReqHandler.close();
  }).listen(port);
  return server;
}
describe('MJpeg Stream (e2e)', function () {
  let mJpegServer, stream;
  before(async function () {
    if (process.version.startsWith('v12')) {
      return this.skip();
    }
    mJpegServer = await initMJpegServer(MJPEG_SERVER_PORT);
  });
  after(function () {
    if (mJpegServer) {
      mJpegServer.close();
    }
    if (stream) {
      stream.stop();
    }
  });
  it('should update mjpeg stream based on new data from mjpeg server', async function () {
    stream = new MJpegStream(MJPEG_SERVER_URL, _lodash.default.noop);
    should.not.exist(stream.lastChunk);
    await stream.start();
    should.exist(stream.lastChunk);
    stream.updateCount.should.eql(1);
    await _bluebird.default.delay(1000);
    stream.updateCount.should.be.above(1);
    const startBytes = Buffer.from([0xff, 0xd8]);
    const endBytes = Buffer.from([0xff, 0xd9]);
    const startPos = stream.lastChunk.indexOf(startBytes);
    const endPos = stream.lastChunk.indexOf(endBytes);
    startPos.should.eql(0);
    endPos.should.eql(1278);
    const b64 = stream.lastChunkBase64;
    b64.should.eql(TEST_IMG_JPG);
    const png = await stream.lastChunkPNGBase64();
    png.should.be.a('string');
    png.indexOf('iVBOR').should.eql(0);
    png.length.should.be.above(400);
    stream.stop();
    await _bluebird.default.delay(1000);
    should.not.exist(stream.lastChunk);
    stream.updateCount.should.eql(0);
  });
  it('should error out if the server does not send any images before a timeout', async function () {
    stream = new MJpegStream(MJPEG_SERVER_URL, _lodash.default.noop);
    await stream.start(0).should.eventually.be.rejectedWith(/never sent/);
  });
});require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdC9tanBlZy1lMmUtc3BlY3MuanMiLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfMiIsIl9jaGFpIiwiX2NoYWlBc1Byb21pc2VkIiwiX2JsdWViaXJkIiwiX2h0dHAiLCJfbWpwZWdTZXJ2ZXIiLCJNSnBlZ1N0cmVhbSIsIm1qcGVnIiwiVEVTVF9JTUdfSlBHIiwic2hvdWxkIiwiY2hhaSIsInVzZSIsImNoYWlBc1Byb21pc2VkIiwiTUpQRUdfU0VSVkVSX1BPUlQiLCJNSlBFR19TRVJWRVJfVVJMIiwiaW5pdE1KcGVnU2VydmVyIiwicG9ydCIsImludE1zIiwidGltZXMiLCJzZXJ2ZXIiLCJodHRwIiwiY3JlYXRlU2VydmVyIiwicmVxIiwicmVzIiwibUpwZWdSZXFIYW5kbGVyIiwibUpwZWdTZXJ2ZXIiLCJjcmVhdGVSZXFIYW5kbGVyIiwianBnIiwiQnVmZmVyIiwiZnJvbSIsImkiLCJCIiwiZGVsYXkiLCJfd3JpdGUiLCJfIiwibm9vcCIsImNsb3NlIiwibGlzdGVuIiwiZGVzY3JpYmUiLCJzdHJlYW0iLCJiZWZvcmUiLCJwcm9jZXNzIiwidmVyc2lvbiIsInN0YXJ0c1dpdGgiLCJza2lwIiwiYWZ0ZXIiLCJzdG9wIiwiaXQiLCJub3QiLCJleGlzdCIsImxhc3RDaHVuayIsInN0YXJ0IiwidXBkYXRlQ291bnQiLCJlcWwiLCJiZSIsImFib3ZlIiwic3RhcnRCeXRlcyIsImVuZEJ5dGVzIiwic3RhcnRQb3MiLCJpbmRleE9mIiwiZW5kUG9zIiwiYjY0IiwibGFzdENodW5rQmFzZTY0IiwicG5nIiwibGFzdENodW5rUE5HQmFzZTY0IiwiYSIsImxlbmd0aCIsImV2ZW50dWFsbHkiLCJyZWplY3RlZFdpdGgiXSwic291cmNlUm9vdCI6Ii4uLy4uIiwic291cmNlcyI6WyJ0ZXN0L21qcGVnLWUyZS1zcGVjcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgbWpwZWcgfSBmcm9tICcuLic7XG5pbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBjaGFpQXNQcm9taXNlZCBmcm9tICdjaGFpLWFzLXByb21pc2VkJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBodHRwIGZyb20gJ2h0dHAnO1xuaW1wb3J0IG1KcGVnU2VydmVyIGZyb20gJ21qcGVnLXNlcnZlcic7XG5cbmNvbnN0IHtNSnBlZ1N0cmVhbX0gPSBtanBlZztcblxuY29uc3QgVEVTVF9JTUdfSlBHID0gJy85ai80UUFZUlhocFpnQUFTVWtxQUFnQUFBQUFBQUFBQUFBQUFQL3NBQkZFZFdOcmVRQUJBQVFBQUFBZUFBRC80UU9CYUhSMGNEb3ZMMjV6TG1Ga2IySmxMbU52YlM5NFlYQXZNUzR3THdBOFAzaHdZV05yWlhRZ1ltVm5hVzQ5SXUrN3Z5SWdhV1E5SWxjMVRUQk5jRU5sYUdsSWVuSmxVM3BPVkdONmEyTTVaQ0kvUGlBOGVEcDRiWEJ0WlhSaElIaHRiRzV6T25nOUltRmtiMkpsT201ek9tMWxkR0V2SWlCNE9uaHRjSFJyUFNKQlpHOWlaU0JZVFZBZ1EyOXlaU0ExTGpZdFl6RTBNQ0EzT1M0eE5qQTBOVEVzSURJd01UY3ZNRFV2TURZdE1ERTZNRGc2TWpFZ0lDQWdJQ0FnSUNJK0lEeHlaR1k2VWtSR0lIaHRiRzV6T25Ka1pqMGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNVGs1T1M4d01pOHlNaTF5WkdZdGMzbHVkR0Y0TFc1ekl5SStJRHh5WkdZNlJHVnpZM0pwY0hScGIyNGdjbVJtT21GaWIzVjBQU0lpSUhodGJHNXpPbmh0Y0UxTlBTSm9kSFJ3T2k4dmJuTXVZV1J2WW1VdVkyOXRMM2hoY0M4eExqQXZiVzB2SWlCNGJXeHVjenB6ZEZKbFpqMGlhSFIwY0RvdkwyNXpMbUZrYjJKbExtTnZiUzk0WVhBdk1TNHdMM05VZVhCbEwxSmxjMjkxY21ObFVtVm1JeUlnZUcxc2JuTTZlRzF3UFNKb2RIUndPaTh2Ym5NdVlXUnZZbVV1WTI5dEwzaGhjQzh4TGpBdklpQjRiWEJOVFRwUGNtbG5hVzVoYkVSdlkzVnRaVzUwU1VROUluaHRjQzVrYVdRNk5HWTVPRGMxT1RjdFpHRTJNeTAwWTJNMExUa3pORE10TkdZeU5qZ3pNR1V3TmprM0lpQjRiWEJOVFRwRWIyTjFiV1Z1ZEVsRVBTSjRiWEF1Wkdsa09qbERNekkzUWtZME4wUTNOVEV4UlRoQ01UbERPVFZETURjMlJERTVNRFk1SWlCNGJYQk5UVHBKYm5OMFlXNWpaVWxFUFNKNGJYQXVhV2xrT2psRE16STNRa1l6TjBRM05URXhSVGhDTVRsRE9UVkRNRGMyUkRFNU1EWTVJaUI0YlhBNlEzSmxZWFJ2Y2xSdmIydzlJa0ZrYjJKbElGQm9iM1J2YzJodmNDQkRReUF5TURFNElDaE5ZV05wYm5SdmMyZ3BJajRnUEhodGNFMU5Pa1JsY21sMlpXUkdjbTl0SUhOMFVtVm1PbWx1YzNSaGJtTmxTVVE5SW5odGNDNXBhV1E2TkdZNU9EYzFPVGN0WkdFMk15MDBZMk0wTFRrek5ETXROR1l5Tmpnek1HVXdOamszSWlCemRGSmxaanBrYjJOMWJXVnVkRWxFUFNKNGJYQXVaR2xrT2pSbU9UZzNOVGszTFdSaE5qTXROR05qTkMwNU16UXpMVFJtTWpZNE16QmxNRFk1TnlJdlBpQThMM0prWmpwRVpYTmpjbWx3ZEdsdmJqNGdQQzl5WkdZNlVrUkdQaUE4TDNnNmVHMXdiV1YwWVQ0Z1BEOTRjR0ZqYTJWMElHVnVaRDBpY2lJL1B2L3VBQTVCWkc5aVpRQmt3QUFBQUFILzJ3Q0VBQkFMQ3dzTUN4QU1EQkFYRHcwUEZ4c1VFQkFVR3g4WEZ4Y1hGeDhlRnhvYUdob1hIaDRqSlNjbEl4NHZMek16THk5QVFFQkFRRUJBUUVCQVFFQkFRRUFCRVE4UEVSTVJGUklTRlJRUkZCRVVHaFFXRmhRYUpob2FIQm9hSmpBakhoNGVIaU13S3k0bkp5Y3VLelUxTURBMU5VQkFQMEJBUUVCQVFFQkFRRUJBUVAvQUFCRUlBQ0FBSUFNQklnQUNFUUVERVFIL3hBQmdBQUVBQXdFQUFBQUFBQUFBQUFBQUFBQUFCQVVIQ0FFQkFBQUFBQUFBQUFBQUFBQUFBQUFBQUJBQUFRTUNBZ3NBQUFBQUFBQUFBQUFBQUFFQ0JCRURFZ1loTVJPRG83UFRWQVVXTmhFQkFBQUFBQUFBQUFBQUFBQUFBQUFBQVAvYUFBd0RBUUFDRVFNUkFEOEF6OEFBZEFBQUFBQUk4K2ZFOGRFdVRadHpaUjdWTWI2T2RURTVHSm9ZaXJyVXAvZThxZDl3YjNUR2UvbEoyNTUxc3g4RC85az0nO1xuXG5jb25zdCBzaG91bGQgPSBjaGFpLnNob3VsZCgpO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5jb25zdCBNSlBFR19TRVJWRVJfUE9SVCA9IDg1ODk7XG5jb25zdCBNSlBFR19TRVJWRVJfVVJMID0gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtNSlBFR19TRVJWRVJfUE9SVH1gO1xuXG5cbi8qKlxuICogU3RhcnQgYW4gbWpwZWcgc2VydmVyIGZvciB0aGUgcHVycG9zZSBvZiB0ZXN0aW5nLCB3aGljaCBqdXN0IHNlbmRzIHRoZSBzYW1lXG4gKiBpbWFnZSBvdmVyIGFuZCBvdmVyLiBDYWxsZXIgaXMgcmVzcG9uc2libGUgZm9yIGNsb3NpbmcgdGhlIHNlcnZlci5cbiAqIEBwYXJhbSB7aW50fSBwb3J0IC0gcG9ydCB0aGUgc2VydmVyIHNob3VsZCBsaXN0ZW4gb25cbiAqIEBwYXJhbSB7aW50fSBbaW50TXNdIC0gaG93IG9mdGVuIHRoZSBzZXJ2ZXIgc2hvdWxkIHB1c2ggYW4gaW1hZ2VcbiAqIEBwYXJhbSB7aW50fSBbdGltZXNdIC0gaG93IG1hbnkgdGltZXMgdGhlIHNlcnZlciBzaG91bGQgcHVzaCBhbiBpbWFnZSBiZWZvcmVcbiAqIGl0IGNsb3NlcyB0aGUgY29ubmVjdGlvblxuICogQHJldHVybnMge2h0dHAuU2VydmVyfVxuICovXG5mdW5jdGlvbiBpbml0TUpwZWdTZXJ2ZXIgKHBvcnQsIGludE1zID0gMzAwLCB0aW1lcyA9IDIwKSB7XG4gIGNvbnN0IHNlcnZlciA9IGh0dHAuY3JlYXRlU2VydmVyKGFzeW5jIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICAgIGNvbnN0IG1KcGVnUmVxSGFuZGxlciA9IG1KcGVnU2VydmVyLmNyZWF0ZVJlcUhhbmRsZXIocmVxLCByZXMpO1xuICAgIGNvbnN0IGpwZyA9IEJ1ZmZlci5mcm9tKFRFU1RfSU1HX0pQRywgJ2Jhc2U2NCcpO1xuXG4gICAgLy8ganVzdCBzZW5kIHRoZSBzYW1lIGpwZWcgb3ZlciBhbmQgb3ZlclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGltZXM7IGkrKykge1xuICAgICAgYXdhaXQgQi5kZWxheShpbnRNcyk7XG4gICAgICBtSnBlZ1JlcUhhbmRsZXIuX3dyaXRlKGpwZywgbnVsbCwgXy5ub29wKTtcbiAgICB9XG4gICAgbUpwZWdSZXFIYW5kbGVyLmNsb3NlKCk7XG4gIH0pLmxpc3Rlbihwb3J0KTtcblxuICByZXR1cm4gc2VydmVyO1xufVxuXG5cbmRlc2NyaWJlKCdNSnBlZyBTdHJlYW0gKGUyZSknLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBtSnBlZ1NlcnZlciwgc3RyZWFtO1xuXG4gIGJlZm9yZShhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgLy8gVE9ETzogcmVtb3ZlIHdoZW4gYnVmZmVydG9vbHMgY2FuIGhhbmRsZSB2MTJcbiAgICBpZiAocHJvY2Vzcy52ZXJzaW9uLnN0YXJ0c1dpdGgoJ3YxMicpKSB7XG4gICAgICByZXR1cm4gdGhpcy5za2lwKCk7XG4gICAgfVxuXG4gICAgbUpwZWdTZXJ2ZXIgPSBhd2FpdCBpbml0TUpwZWdTZXJ2ZXIoTUpQRUdfU0VSVkVSX1BPUlQpO1xuICB9KTtcblxuICBhZnRlcihmdW5jdGlvbiAoKSB7XG4gICAgaWYgKG1KcGVnU2VydmVyKSB7XG4gICAgICBtSnBlZ1NlcnZlci5jbG9zZSgpO1xuICAgIH1cbiAgICBpZiAoc3RyZWFtKSB7XG4gICAgICBzdHJlYW0uc3RvcCgpOyAvLyBlbnN1cmUgc3RyZWFtcyBhcmUgYWx3YXlzIHN0b3BwZWRcbiAgICB9XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgdXBkYXRlIG1qcGVnIHN0cmVhbSBiYXNlZCBvbiBuZXcgZGF0YSBmcm9tIG1qcGVnIHNlcnZlcicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBzdHJlYW0gPSBuZXcgTUpwZWdTdHJlYW0oTUpQRUdfU0VSVkVSX1VSTCwgXy5ub29wKTtcbiAgICBzaG91bGQubm90LmV4aXN0KHN0cmVhbS5sYXN0Q2h1bmspO1xuICAgIGF3YWl0IHN0cmVhbS5zdGFydCgpO1xuICAgIHNob3VsZC5leGlzdChzdHJlYW0ubGFzdENodW5rKTtcbiAgICBzdHJlYW0udXBkYXRlQ291bnQuc2hvdWxkLmVxbCgxKTtcblxuICAgIGF3YWl0IEIuZGVsYXkoMTAwMCk7IC8vIGxldCB0aGUgc3RyZWFtIHVwZGF0ZSBhIGJpdFxuICAgIHN0cmVhbS51cGRhdGVDb3VudC5zaG91bGQuYmUuYWJvdmUoMSk7XG5cbiAgICAvLyB2ZXJpZnkganBlZyB0eXBlIGFuZCBieXRlIGxlbmd0aCBvZiBmaXh0dXJlIGltYWdlXG4gICAgY29uc3Qgc3RhcnRCeXRlcyA9IEJ1ZmZlci5mcm9tKFsweGZmLCAweGQ4XSk7XG4gICAgY29uc3QgZW5kQnl0ZXMgPSBCdWZmZXIuZnJvbShbMHhmZiwgMHhkOV0pO1xuICAgIGNvbnN0IHN0YXJ0UG9zID0gc3RyZWFtLmxhc3RDaHVuay5pbmRleE9mKHN0YXJ0Qnl0ZXMpO1xuICAgIGNvbnN0IGVuZFBvcyA9IHN0cmVhbS5sYXN0Q2h1bmsuaW5kZXhPZihlbmRCeXRlcyk7XG4gICAgc3RhcnRQb3Muc2hvdWxkLmVxbCgwKTsgLy8gcHJvdmVzIHdlIGhhdmUgYSBqcGVnXG4gICAgZW5kUG9zLnNob3VsZC5lcWwoMTI3OCk7IC8vIHByb3ZlcyB3ZSBoYXZlIGEganBlZyBvZiB0aGUgcmlnaHQgc2l6ZVxuXG4gICAgLy8gdmVyaWZ5IHdlIGNhbiBnZXQgdGhlIGJhc2U2NCB2ZXJzaW9uIHRvb1xuICAgIGNvbnN0IGI2NCA9IHN0cmVhbS5sYXN0Q2h1bmtCYXNlNjQ7XG4gICAgYjY0LnNob3VsZC5lcWwoVEVTVF9JTUdfSlBHKTtcblxuICAgIC8vIHZlcmlmeSB3ZSBjYW4gZ2V0IHRoZSBQTkcgdmVyc2lvbiB0b29cbiAgICBjb25zdCBwbmcgPSBhd2FpdCBzdHJlYW0ubGFzdENodW5rUE5HQmFzZTY0KCk7XG4gICAgcG5nLnNob3VsZC5iZS5hKCdzdHJpbmcnKTtcbiAgICBwbmcuaW5kZXhPZignaVZCT1InKS5zaG91bGQuZXFsKDApO1xuICAgIHBuZy5sZW5ndGguc2hvdWxkLmJlLmFib3ZlKDQwMCk7XG5cblxuICAgIC8vIG5vdyBzdG9wIHRoZSBzdHJlYW0gYW5kIHdhaXQgc29tZSBtb3JlIHRoZW4gYXNzZXJ0IG5vIG5ldyBkYXRhIGhhcyBjb21lIGluXG4gICAgc3RyZWFtLnN0b3AoKTtcbiAgICBhd2FpdCBCLmRlbGF5KDEwMDApO1xuICAgIHNob3VsZC5ub3QuZXhpc3Qoc3RyZWFtLmxhc3RDaHVuayk7XG4gICAgc3RyZWFtLnVwZGF0ZUNvdW50LnNob3VsZC5lcWwoMCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgZXJyb3Igb3V0IGlmIHRoZSBzZXJ2ZXIgZG9lcyBub3Qgc2VuZCBhbnkgaW1hZ2VzIGJlZm9yZSBhIHRpbWVvdXQnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgc3RyZWFtID0gbmV3IE1KcGVnU3RyZWFtKE1KUEVHX1NFUlZFUl9VUkwsIF8ubm9vcCk7XG4gICAgYXdhaXQgc3RyZWFtLnN0YXJ0KDApLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvbmV2ZXIgc2VudC8pO1xuICB9KTtcblxufSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxJQUFBQSxPQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxFQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxLQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxlQUFBLEdBQUFKLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSSxTQUFBLEdBQUFMLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBSyxLQUFBLEdBQUFOLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBTSxZQUFB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
